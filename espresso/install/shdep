#!/bin/sh
# compute dependencies

INSTALL=install
make moduledep.x 

# directory that only depends on itself
cd ../Modules
ls *.f90 > tmp1
ls *.f90 > tmp2
../$INSTALL/moduledep.x tmp1 tmp2 > .dependencies

# directories that depend on Modules/
DIRS="PW FPMD CPV flib"
for DIR in $DIRS ; do
  if test -d ../$DIR ; then
    cd ../$DIR
    ls *.f90 > tmp1
    ls *.f90 ../Modules/*.f90 > tmp2
    ../$INSTALL/moduledep.x tmp1 tmp2 > .dependencies
  fi
done

# directories that depend on Modules/, PW/
DIRS="PP PWCOND PWNC Gamma PH NEB"
for DIR in $DIRS ; do
  if test -d ../$DIR ; then
     cd ../$DIR
     ls *.f90 > tmp1
     ls *.f90 ../PW/*.f90 ../Modules/*.f90 > tmp2
     ../$INSTALL/moduledep.x tmp1 tmp2 > .dependencies
  fi
done

# directories that depend on Modules/, PW/, PH/
DIRS="D3"
for DIR in $DIRS ; do
  if test -d ../$DIR ; then
    cd ../$DIR
    ls *.f90 > tmp1
    ls *.f90 ../PW/*.f90 ../PH/*.f90 ../Modules/*.f90 > tmp2
    ../$INSTALL/moduledep.x tmp1 tmp2 > .dependencies
  fi
done
