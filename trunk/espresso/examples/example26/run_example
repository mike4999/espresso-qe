#!/bin/sh

# contributed by Y. Kanai (ykanai@princeton.edu)
# reference: JCP 121, 3359 (2004)

# run from directory where this script is
cd `echo $0 | sed 's/\(.*\)\/.*/\1/'` # extract pathname
EXAMPLE_DIR=`pwd`

# check whether echo has the -e option
if test "`echo -e`" = "-e" ; then ECHO=echo ; else ECHO="echo -e" ; fi

$ECHO
$ECHO "$EXAMPLE_DIR : starting"
$ECHO
$ECHO "This example shows how to use cp.x to calculate minimum energy path"
$ECHO "(MEP) using string method (smd)."
$ECHO
$ECHO " This script runs a sequence of CP-SMD calculations to get the MEP"
$ECHO " 1. Minimize electronic degrees of freedom"
$ECHO " 2. Locate the MEP" 

# set the needed environment variables
. ../environment_variables

# required executables and pseudopotentials
BIN_LIST="cp.x"
PSEUDO_LIST="Si.vbc.UPF H.vbc.UPF"

$ECHO
$ECHO "  executables directory: $BIN_DIR"
$ECHO "  pseudo directory:      $PSEUDO_DIR"
$ECHO "  temporary directory:   $TMP_DIR"
$ECHO "  checking that needed directories and files exist...\c"

# check for directories
for DIR in "$BIN_DIR" "$PSEUDO_DIR" ; do
    if test ! -d $DIR ; then
        $ECHO
        $ECHO "ERROR: $DIR not existent or not a directory"
        $ECHO "Aborting"
        exit 1
     fi
done
for DIR in "$TMP_DIR" "$EXAMPLE_DIR/results" ; do
    if test ! -d $DIR ; then
        mkdir $DIR
    fi
done
cd $EXAMPLE_DIR/results

# check for executables
for FILE in $BIN_LIST ; do
    if test ! -x $BIN_DIR/$FILE ; then
        $ECHO
        $ECHO "ERROR: $BIN_DIR/$FILE not existent or not executable"
        $ECHO "Aborting"
        exit 1
    fi
done

# check for pseudopotentials
for FILE in $PSEUDO_LIST ; do
    if test ! -r $PSEUDO_DIR/$FILE ; then
        $ECHO
        $ECHO "ERROR: $PSEUDO_DIR/$FILE not existent or not readable"
        $ECHO "Aborting"
        exit 1
    fi
done
$ECHO " done"

# how to run executables
CP_COMMAND="$PARA_PREFIX $BIN_DIR/cp.x $PARA_POSTFIX"
$ECHO
$ECHO "  running cp.x as: $CP_COMMAND"
$ECHO

# clean TMP_DIR
$ECHO "  cleaning $TMP_DIR...\c"
rm -rf $TMP_DIR/*
$ECHO " done"

# run smd in one shot

cat > smd1.in << EOF
 &control
    restart_mode='from_scratch',
    calculation='smd',
    nstep=10, iprint=100, dt=10.d0,
    ndr=60, ndw=60,
    pseudo_dir = '$PSEUDO_DIR/',
    outdir='$TMP_DIR/'
 /
 &system
    ibrav = 14,
    celldm(1) = 14.3967d0, celldm(2) = 1.d0, celldm(3) = 1.3d0,
    celldm(4) = 0.d0, celldm(5) = 0.d0, celldm(6) = 0.d0,
    nat   = 26, nbnd  = 40, nelec  = 80, ntyp  = 2, ecutwfc  = 12.0d0,
    nr1b  = 16, nr2b = 16, nr3b = 16,
    xc_type = 'PZ'
 /
 &electrons
    emass = 500.d0,
    emass_cutoff = 2.5d0,
    electron_damping = 1.0,
    orthogonalization = 'ortho',
    electron_dynamics = 'damp',
 /
 &ions
    ion_dynamics = 'none',
    ion_damping = 1.0,
    num_of_images = 10,
    ion_radius(1) = 1.0,
    ion_radius(2) = 1.0,
    smd_smcp = .true.,
    smd_smlm = .false.,
    smd_smopt = .false.,
    smd_linr = .true.,
    smd_polm = .false.,
    smd_kwnp = 2,
    smd_stcd = .false.,
    smd_lmfreq  = 1,
    smd_tol = 1.d-5,
    smd_maxlm = 100,
    smd_codf = 50,
    smd_forf = 50,
    smd_smwf = 1,
    smd_ene_ini = -75.01969,
    smd_ene_fin = -75.03376 
 /
ATOMIC_SPECIES
Si  10.0  Si.vbc.UPF 4
H   10.0  H.vbc.UPF  4
K_POINTS ( gamma )
ATOMIC_POSITIONS ( bohr )
first_image
Si      10.775166917   1.063244573   3.343251712
Si      10.754798756   6.063372808   3.328320441
Si       8.376020820   0.022551091  -0.335304264
Si       8.251195082   7.044890119  -0.250169658
Si      13.284658653   7.174660007  -0.223938232
Si      13.203527321   0.153946724  -0.326655168
Si       7.181555534   3.526386193  -2.609991910
Si       7.310566102  -3.661066027  -2.446982016
Si      14.386467659   3.681546725  -2.591582642
Si      14.258348763  -3.537912425  -2.428409132
Si      10.787703249   3.602320221  -5.162014074
Si      10.789827407  -3.607727761  -5.163581985
Si      17.981530206  -3.597398649  -4.902229019
Si      17.979324999   3.597821759  -5.096370053
Si       10.79752500   7.19835000  -7.60000000  0  0  0
Si       17.99587500   7.19835000  -7.60000000  0  0  0
Si       10.79752500   0.00000000  -7.60000000  0  0  0
Si       17.99587500   0.00000000  -7.60000000  0  0  0
H        12.89752500   7.19835000  -9.40000000  0  0  0
H         8.69752500   7.19835000  -9.40000000  0  0  0
H        20.09587500   7.19835000  -9.40000000  0  0  0
H        15.89587500   7.19835000  -9.40000000  0  0  0
H        12.89752500   0.00000000  -9.40000000  0  0  0
H         8.69752500   0.00000000  -9.40000000  0  0  0
H        20.09587500   0.00000000  -9.40000000  0  0  0
H        15.89587500   0.00000000  -9.40000000  0  0  0
last_image
Si       8.472330841   3.600583711   2.168169163
Si      12.898398887   3.599061696   2.186786225
Si       8.586785223   0.086978384  -0.771506632
Si       8.587325096   7.111877751  -0.768441643
Si      12.983360476   7.115115556  -0.737726857
Si      12.981576168   0.084546884  -0.735118510
Si       7.302618068   3.600948032  -2.980309976
Si       7.098754396  -3.598207353  -2.357153735
Si      14.209730212   3.597886598  -2.970999964
Si      14.459594393  -3.599128700  -2.352619378
Si      10.760159199   3.599567862  -5.451711568
Si      10.783817535  -3.598768371  -4.975693256
Si      17.979750932  -3.599176567  -4.999362791
Si      17.954630751   3.599200343  -5.121900920
Si       10.79752500   7.19835000  -7.60000000
Si       17.99587500   7.19835000  -7.60000000
Si       10.79752500   0.00000000  -7.60000000
Si       17.99587500   0.00000000  -7.60000000
H        12.89752500   7.19835000  -9.40000000
H         8.69752500   7.19835000  -9.40000000
H        20.09587500   7.19835000  -9.40000000
H        15.89587500   7.19835000  -9.40000000
H        12.89752500   0.00000000  -9.40000000
H         8.69752500   0.00000000  -9.40000000
H        20.09587500   0.00000000  -9.40000000
H        15.89587500   0.00000000  -9.40000000
EOF
$ECHO "  running first SMD calculation ...\c"
if test "0$1" -ge 1 ; then
    $CP_COMMAND < smd1.in > smd1.out
    $ECHO " done"
else
    $ECHO " skipped" # too big, don't run
fi

cat > smd2.in << EOF
 &control
    restart_mode='reset_counters',
    calculation='smd',
    nstep=100, iprint=100, dt=10.d0,
    ndr=60, ndw=60,
    pseudo_dir = '$PSEUDO_DIR/',
    outdir='$TMP_DIR/'
 /
 &system
    ibrav = 14,
    celldm(1) = 14.3967d0, celldm(2) = 1.d0, celldm(3) = 1.3d0,
    celldm(4) = 0.d0, celldm(5) = 0.d0, celldm(6) = 0.d0,
    nat   = 26, nbnd  = 40, nelec  = 80, ntyp  = 2, ecutwfc  = 12.0d0,
    nr1b  = 16, nr2b = 16, nr3b = 16,
    xc_type = 'PZ'
 /
 &electrons
    emass = 500.d0,
    emass_cutoff = 2.5d0,
    electron_damping = 0.5,
    orthogonalization = 'ortho',
    electron_dynamics = 'damp',
 /
 &ions
    ion_dynamics = 'none',
    ion_damping = 1.0,
    num_of_images = 10,
    ion_radius(1) = 1.0,
    ion_radius(2) = 1.0,
    smd_smcp = .true.,
    smd_smlm = .false.,
    smd_smopt = .false.,
    smd_linr = .true.,
    smd_polm = .false.,
    smd_kwnp = 2,
    smd_stcd = .false.,
    smd_lmfreq  = 1,
    smd_tol = 1.d-5,
    smd_maxlm = 100,
    smd_codf = 50,
    smd_forf = 50,
    smd_smwf = 1,
    smd_ene_ini = -75.01969,
    smd_ene_fin = -75.03376 
 /
ATOMIC_SPECIES
Si  10.0  Si.vbc.UPF 4
H   10.0  H.vbc.UPF  4
K_POINTS ( gamma )
ATOMIC_POSITIONS ( bohr )
first_image
Si      10.775166917   1.063244573   3.343251712
Si      10.754798756   6.063372808   3.328320441
Si       8.376020820   0.022551091  -0.335304264
Si       8.251195082   7.044890119  -0.250169658
Si      13.284658653   7.174660007  -0.223938232
Si      13.203527321   0.153946724  -0.326655168
Si       7.181555534   3.526386193  -2.609991910
Si       7.310566102  -3.661066027  -2.446982016
Si      14.386467659   3.681546725  -2.591582642
Si      14.258348763  -3.537912425  -2.428409132
Si      10.787703249   3.602320221  -5.162014074
Si      10.789827407  -3.607727761  -5.163581985
Si      17.981530206  -3.597398649  -4.902229019
Si      17.979324999   3.597821759  -5.096370053
Si       10.79752500   7.19835000  -7.60000000  0  0  0
Si       17.99587500   7.19835000  -7.60000000  0  0  0
Si       10.79752500   0.00000000  -7.60000000  0  0  0
Si       17.99587500   0.00000000  -7.60000000  0  0  0
H        12.89752500   7.19835000  -9.40000000  0  0  0
H         8.69752500   7.19835000  -9.40000000  0  0  0
H        20.09587500   7.19835000  -9.40000000  0  0  0
H        15.89587500   7.19835000  -9.40000000  0  0  0
H        12.89752500   0.00000000  -9.40000000  0  0  0
H         8.69752500   0.00000000  -9.40000000  0  0  0
H        20.09587500   0.00000000  -9.40000000  0  0  0
H        15.89587500   0.00000000  -9.40000000  0  0  0
last_image
Si       8.472330841   3.600583711   2.168169163
Si      12.898398887   3.599061696   2.186786225
Si       8.586785223   0.086978384  -0.771506632
Si       8.587325096   7.111877751  -0.768441643
Si      12.983360476   7.115115556  -0.737726857
Si      12.981576168   0.084546884  -0.735118510
Si       7.302618068   3.600948032  -2.980309976
Si       7.098754396  -3.598207353  -2.357153735
Si      14.209730212   3.597886598  -2.970999964
Si      14.459594393  -3.599128700  -2.352619378
Si      10.760159199   3.599567862  -5.451711568
Si      10.783817535  -3.598768371  -4.975693256
Si      17.979750932  -3.599176567  -4.999362791
Si      17.954630751   3.599200343  -5.121900920
Si       10.79752500   7.19835000  -7.60000000
Si       17.99587500   7.19835000  -7.60000000
Si       10.79752500   0.00000000  -7.60000000
Si       17.99587500   0.00000000  -7.60000000
H        12.89752500   7.19835000  -9.40000000
H         8.69752500   7.19835000  -9.40000000
H        20.09587500   7.19835000  -9.40000000
H        15.89587500   7.19835000  -9.40000000
H        12.89752500   0.00000000  -9.40000000
H         8.69752500   0.00000000  -9.40000000
H        20.09587500   0.00000000  -9.40000000
H        15.89587500   0.00000000  -9.40000000
EOF
$ECHO "  running second SMD calculation ...\c"
if test "0$1" -ge 2 ; then
    $CP_COMMAND < smd2.in > smd2.out
    $ECHO " done"
else
    $ECHO " skipped" # too big, don't run
fi

cat > smd3.in << EOF
 &control
    restart_mode='restart',
    calculation='smd',
    nstep=200, iprint=100, dt=10.d0,
    ndr=60, ndw=60,
    pseudo_dir = '$PSEUDO_DIR/',
    outdir='$TMP_DIR/'
 /
 &system
    ibrav = 14,
    celldm(1) = 14.3967d0, celldm(2) = 1.d0, celldm(3) = 1.3d0,
    celldm(4) = 0.d0, celldm(5) = 0.d0, celldm(6) = 0.d0,
    nat   = 26, nbnd  = 40, nelec  = 80, ntyp  = 2, ecutwfc  = 12.0d0,
    nr1b  = 16, nr2b = 16, nr3b = 16,
    xc_type = 'PZ'
 /
 &electrons
    emass = 500.d0,
    emass_cutoff = 2.5d0,
    electron_damping = 0.1,
    orthogonalization = 'ortho',
    electron_dynamics = 'damp',
 /
 &ions
    ion_dynamics = 'none',
    ion_damping = 1.0,
    num_of_images = 10,
    ion_radius(1) = 1.0,
    ion_radius(2) = 1.0,
    smd_smcp = .true.,
    smd_smlm = .true.,
    smd_smopt = .false.,
    smd_linr = .true.,
    smd_polm = .false.,
    smd_kwnp = 2,
    smd_stcd = .false.,
    smd_lmfreq  = 1,
    smd_tol = 1.d-5,
    smd_maxlm = 100,
    smd_codf = 50,
    smd_forf = 50,
    smd_smwf = 1,
    smd_ene_ini = -75.01969,
    smd_ene_fin = -75.03376 
 /
ATOMIC_SPECIES
Si  10.0  Si.vbc.UPF 4
H   10.0  H.vbc.UPF  4
K_POINTS ( gamma )
ATOMIC_POSITIONS ( bohr )
first_image
Si      10.775166917   1.063244573   3.343251712
Si      10.754798756   6.063372808   3.328320441
Si       8.376020820   0.022551091  -0.335304264
Si       8.251195082   7.044890119  -0.250169658
Si      13.284658653   7.174660007  -0.223938232
Si      13.203527321   0.153946724  -0.326655168
Si       7.181555534   3.526386193  -2.609991910
Si       7.310566102  -3.661066027  -2.446982016
Si      14.386467659   3.681546725  -2.591582642
Si      14.258348763  -3.537912425  -2.428409132
Si      10.787703249   3.602320221  -5.162014074
Si      10.789827407  -3.607727761  -5.163581985
Si      17.981530206  -3.597398649  -4.902229019
Si      17.979324999   3.597821759  -5.096370053
Si       10.79752500   7.19835000  -7.60000000  0  0  0
Si       17.99587500   7.19835000  -7.60000000  0  0  0
Si       10.79752500   0.00000000  -7.60000000  0  0  0
Si       17.99587500   0.00000000  -7.60000000  0  0  0
H        12.89752500   7.19835000  -9.40000000  0  0  0
H         8.69752500   7.19835000  -9.40000000  0  0  0
H        20.09587500   7.19835000  -9.40000000  0  0  0
H        15.89587500   7.19835000  -9.40000000  0  0  0
H        12.89752500   0.00000000  -9.40000000  0  0  0
H         8.69752500   0.00000000  -9.40000000  0  0  0
H        20.09587500   0.00000000  -9.40000000  0  0  0
H        15.89587500   0.00000000  -9.40000000  0  0  0
last_image
Si       8.472330841   3.600583711   2.168169163
Si      12.898398887   3.599061696   2.186786225
Si       8.586785223   0.086978384  -0.771506632
Si       8.587325096   7.111877751  -0.768441643
Si      12.983360476   7.115115556  -0.737726857
Si      12.981576168   0.084546884  -0.735118510
Si       7.302618068   3.600948032  -2.980309976
Si       7.098754396  -3.598207353  -2.357153735
Si      14.209730212   3.597886598  -2.970999964
Si      14.459594393  -3.599128700  -2.352619378
Si      10.760159199   3.599567862  -5.451711568
Si      10.783817535  -3.598768371  -4.975693256
Si      17.979750932  -3.599176567  -4.999362791
Si      17.954630751   3.599200343  -5.121900920
Si       10.79752500   7.19835000  -7.60000000
Si       17.99587500   7.19835000  -7.60000000
Si       10.79752500   0.00000000  -7.60000000
Si       17.99587500   0.00000000  -7.60000000
H        12.89752500   7.19835000  -9.40000000
H         8.69752500   7.19835000  -9.40000000
H        20.09587500   7.19835000  -9.40000000
H        15.89587500   7.19835000  -9.40000000
H        12.89752500   0.00000000  -9.40000000
H         8.69752500   0.00000000  -9.40000000
H        20.09587500   0.00000000  -9.40000000
H        15.89587500   0.00000000  -9.40000000
EOF
$ECHO "  running third SMD calculation ...\c"
if test "0$1" -ge 3 ; then
    $CP_COMMAND < smd3.in > smd3.out
    $ECHO " done"
else
    $ECHO " skipped" # too big, don't run
fi

cat > smd4.in << EOF
 &control
    restart_mode='restart',
    calculation='smd',
    nstep=200, iprint=100, dt=10.d0,
    ndr=60, ndw=60,
    pseudo_dir = '$PSEUDO_DIR/',
    outdir='$TMP_DIR/'
 /
 &system
    ibrav = 14,
    celldm(1) = 14.3967d0, celldm(2) = 1.d0, celldm(3) = 1.3d0,
    celldm(4) = 0.d0, celldm(5) = 0.d0, celldm(6) = 0.d0,
    nat   = 26, nbnd  = 40, nelec  = 80, ntyp  = 2, ecutwfc  = 12.0d0,
    nr1b  = 16, nr2b = 16, nr3b = 16,
    xc_type = 'PZ'
 /
 &electrons
    emass = 500.d0,
    emass_cutoff = 2.5d0,
    electron_damping = 0.05,
    orthogonalization = 'ortho',
    electron_dynamics = 'damp',
 /
 &ions
    ion_dynamics = 'none',
    ion_damping = 1.0,
    num_of_images = 10,
    ion_radius(1) = 1.0,
    ion_radius(2) = 1.0,
    smd_smcp = .true.,
    smd_smlm = .true.,
    smd_smopt = .false.,
    smd_linr = .true.,
    smd_polm = .false.,
    smd_kwnp = 2,
    smd_stcd = .false.,
    smd_lmfreq  = 1,
    smd_tol = 1.d-5,
    smd_maxlm = 100,
    smd_codf = 50,
    smd_forf = 50,
    smd_smwf = 1,
    smd_ene_ini = -75.01969,
    smd_ene_fin = -75.03376 
 /
ATOMIC_SPECIES
Si  10.0  Si.vbc.UPF 4
H   10.0  H.vbc.UPF  4
K_POINTS ( gamma )
ATOMIC_POSITIONS ( bohr )
first_image
Si      10.775166917   1.063244573   3.343251712
Si      10.754798756   6.063372808   3.328320441
Si       8.376020820   0.022551091  -0.335304264
Si       8.251195082   7.044890119  -0.250169658
Si      13.284658653   7.174660007  -0.223938232
Si      13.203527321   0.153946724  -0.326655168
Si       7.181555534   3.526386193  -2.609991910
Si       7.310566102  -3.661066027  -2.446982016
Si      14.386467659   3.681546725  -2.591582642
Si      14.258348763  -3.537912425  -2.428409132
Si      10.787703249   3.602320221  -5.162014074
Si      10.789827407  -3.607727761  -5.163581985
Si      17.981530206  -3.597398649  -4.902229019
Si      17.979324999   3.597821759  -5.096370053
Si       10.79752500   7.19835000  -7.60000000  0  0  0
Si       17.99587500   7.19835000  -7.60000000  0  0  0
Si       10.79752500   0.00000000  -7.60000000  0  0  0
Si       17.99587500   0.00000000  -7.60000000  0  0  0
H        12.89752500   7.19835000  -9.40000000  0  0  0
H         8.69752500   7.19835000  -9.40000000  0  0  0
H        20.09587500   7.19835000  -9.40000000  0  0  0
H        15.89587500   7.19835000  -9.40000000  0  0  0
H        12.89752500   0.00000000  -9.40000000  0  0  0
H         8.69752500   0.00000000  -9.40000000  0  0  0
H        20.09587500   0.00000000  -9.40000000  0  0  0
H        15.89587500   0.00000000  -9.40000000  0  0  0
last_image
Si       8.472330841   3.600583711   2.168169163
Si      12.898398887   3.599061696   2.186786225
Si       8.586785223   0.086978384  -0.771506632
Si       8.587325096   7.111877751  -0.768441643
Si      12.983360476   7.115115556  -0.737726857
Si      12.981576168   0.084546884  -0.735118510
Si       7.302618068   3.600948032  -2.980309976
Si       7.098754396  -3.598207353  -2.357153735
Si      14.209730212   3.597886598  -2.970999964
Si      14.459594393  -3.599128700  -2.352619378
Si      10.760159199   3.599567862  -5.451711568
Si      10.783817535  -3.598768371  -4.975693256
Si      17.979750932  -3.599176567  -4.999362791
Si      17.954630751   3.599200343  -5.121900920
Si       10.79752500   7.19835000  -7.60000000
Si       17.99587500   7.19835000  -7.60000000
Si       10.79752500   0.00000000  -7.60000000
Si       17.99587500   0.00000000  -7.60000000
H        12.89752500   7.19835000  -9.40000000
H         8.69752500   7.19835000  -9.40000000
H        20.09587500   7.19835000  -9.40000000
H        15.89587500   7.19835000  -9.40000000
H        12.89752500   0.00000000  -9.40000000
H         8.69752500   0.00000000  -9.40000000
H        20.09587500   0.00000000  -9.40000000
H        15.89587500   0.00000000  -9.40000000
EOF
$ECHO "  running fourth SMD calculation ...\c"
if test "0$1" -ge 4 ; then
    $CP_COMMAND < smd4.in > smd4.out
    $ECHO " done"
else
    $ECHO " skipped" # too big, don't run
fi

cat > smd5.in << EOF
 &control
    restart_mode='reset_counters',
    calculation='smd',
    nstep=100, iprint=100, dt=10.d0,
    ndr=60, ndw=70,
    pseudo_dir = '$PSEUDO_DIR/',
    outdir='$TMP_DIR/'
 /
 &system
    ibrav = 14,
    celldm(1) = 14.3967d0, celldm(2) = 1.d0, celldm(3) = 1.3d0,
    celldm(4) = 0.d0, celldm(5) = 0.d0, celldm(6) = 0.d0,
    nat   = 26, nbnd  = 40, nelec  = 80, ntyp  = 2, ecutwfc  = 12.0d0,
    nr1b  = 16, nr2b = 16, nr3b = 16,
    xc_type = 'PZ'
 /
 &electrons
    emass = 500.d0,
    emass_cutoff = 2.5d0,
    electron_damping = 0.8,
    orthogonalization = 'ortho',
    electron_dynamics = 'damp',
 /
 &ions
    ion_dynamics = 'damp',
    ion_damping = 0.5,
    num_of_images = 10,
    ion_radius(1) = 1.0,
    ion_radius(2) = 1.0,
    smd_smcp = .false.,
    smd_smlm = .true.,
    smd_smopt = .false.,
    smd_linr = .true.,
    smd_polm = .false.,
    smd_kwnp = 2,
    smd_stcd = .false.,
    smd_lmfreq  = 1,
    smd_tol = 1.d-5,
    smd_maxlm = 100,
    smd_codf = 50,
    smd_forf = 50,
    smd_smwf = 1,
    smd_ene_ini = -75.01969,
    smd_ene_fin = -75.03376 
 /
ATOMIC_SPECIES
Si  10.0  Si.vbc.UPF 4
H   10.0  H.vbc.UPF  4
K_POINTS ( gamma )
ATOMIC_POSITIONS ( bohr )
first_image
Si      10.775166917   1.063244573   3.343251712
Si      10.754798756   6.063372808   3.328320441
Si       8.376020820   0.022551091  -0.335304264
Si       8.251195082   7.044890119  -0.250169658
Si      13.284658653   7.174660007  -0.223938232
Si      13.203527321   0.153946724  -0.326655168
Si       7.181555534   3.526386193  -2.609991910
Si       7.310566102  -3.661066027  -2.446982016
Si      14.386467659   3.681546725  -2.591582642
Si      14.258348763  -3.537912425  -2.428409132
Si      10.787703249   3.602320221  -5.162014074
Si      10.789827407  -3.607727761  -5.163581985
Si      17.981530206  -3.597398649  -4.902229019
Si      17.979324999   3.597821759  -5.096370053
Si       10.79752500   7.19835000  -7.60000000  0  0  0
Si       17.99587500   7.19835000  -7.60000000  0  0  0
Si       10.79752500   0.00000000  -7.60000000  0  0  0
Si       17.99587500   0.00000000  -7.60000000  0  0  0
H        12.89752500   7.19835000  -9.40000000  0  0  0
H         8.69752500   7.19835000  -9.40000000  0  0  0
H        20.09587500   7.19835000  -9.40000000  0  0  0
H        15.89587500   7.19835000  -9.40000000  0  0  0
H        12.89752500   0.00000000  -9.40000000  0  0  0
H         8.69752500   0.00000000  -9.40000000  0  0  0
H        20.09587500   0.00000000  -9.40000000  0  0  0
H        15.89587500   0.00000000  -9.40000000  0  0  0
last_image
Si       8.472330841   3.600583711   2.168169163
Si      12.898398887   3.599061696   2.186786225
Si       8.586785223   0.086978384  -0.771506632
Si       8.587325096   7.111877751  -0.768441643
Si      12.983360476   7.115115556  -0.737726857
Si      12.981576168   0.084546884  -0.735118510
Si       7.302618068   3.600948032  -2.980309976
Si       7.098754396  -3.598207353  -2.357153735
Si      14.209730212   3.597886598  -2.970999964
Si      14.459594393  -3.599128700  -2.352619378
Si      10.760159199   3.599567862  -5.451711568
Si      10.783817535  -3.598768371  -4.975693256
Si      17.979750932  -3.599176567  -4.999362791
Si      17.954630751   3.599200343  -5.121900920
Si       10.79752500   7.19835000  -7.60000000
Si       17.99587500   7.19835000  -7.60000000
Si       10.79752500   0.00000000  -7.60000000
Si       17.99587500   0.00000000  -7.60000000
H        12.89752500   7.19835000  -9.40000000
H         8.69752500   7.19835000  -9.40000000
H        20.09587500   7.19835000  -9.40000000
H        15.89587500   7.19835000  -9.40000000
H        12.89752500   0.00000000  -9.40000000
H         8.69752500   0.00000000  -9.40000000
H        20.09587500   0.00000000  -9.40000000
H        15.89587500   0.00000000  -9.40000000
EOF
$ECHO "  running fifth SMD calculation ...\c"
if test "0$1" -ge 5 ; then
    $CP_COMMAND < smd5.in > smd5.out
    $ECHO " done"
else
    $ECHO " skipped" # too big, don't run
fi

cat > smd6.in << EOF
 &control
    restart_mode='restart',
    calculation='smd',
    nstep=200, iprint=100, dt=10.d0,
    ndr=70, ndw=70,
    pseudo_dir = '$PSEUDO_DIR/',
    outdir='$TMP_DIR/'
 /
 &system
    ibrav = 14,
    celldm(1) = 14.3967d0, celldm(2) = 1.d0, celldm(3) = 1.3d0,
    celldm(4) = 0.d0, celldm(5) = 0.d0, celldm(6) = 0.d0,
    nat   = 26, nbnd  = 40, nelec  = 80, ntyp  = 2, ecutwfc  = 12.0d0,
    nr1b  = 16, nr2b = 16, nr3b = 16,
    xc_type = 'PZ'
 /
 &electrons
    emass = 500.d0,
    emass_cutoff = 2.5d0,
    electron_damping = 0.8,
    orthogonalization = 'ortho',
    electron_dynamics = 'damp',
 /
 &ions
    ion_dynamics = 'damp',
    ion_damping = 0.1,
    num_of_images = 10,
    ion_radius(1) = 1.0,
    ion_radius(2) = 1.0,
    smd_smcp = .false.,
    smd_smlm = .true.,
    smd_smopt = .false.,
    smd_linr = .true.,
    smd_polm = .false.,
    smd_kwnp = 2,
    smd_stcd = .false.,
    smd_lmfreq  = 1,
    smd_tol = 1.d-5,
    smd_maxlm = 100,
    smd_codf = 50,
    smd_forf = 50,
    smd_smwf = 1,
    smd_ene_ini = -75.01969,
    smd_ene_fin = -75.03376 
 /
ATOMIC_SPECIES
Si  10.0  Si.vbc.UPF 4
H   10.0  H.vbc.UPF  4
K_POINTS ( gamma )
ATOMIC_POSITIONS ( bohr )
first_image
Si      10.775166917   1.063244573   3.343251712
Si      10.754798756   6.063372808   3.328320441
Si       8.376020820   0.022551091  -0.335304264
Si       8.251195082   7.044890119  -0.250169658
Si      13.284658653   7.174660007  -0.223938232
Si      13.203527321   0.153946724  -0.326655168
Si       7.181555534   3.526386193  -2.609991910
Si       7.310566102  -3.661066027  -2.446982016
Si      14.386467659   3.681546725  -2.591582642
Si      14.258348763  -3.537912425  -2.428409132
Si      10.787703249   3.602320221  -5.162014074
Si      10.789827407  -3.607727761  -5.163581985
Si      17.981530206  -3.597398649  -4.902229019
Si      17.979324999   3.597821759  -5.096370053
Si       10.79752500   7.19835000  -7.60000000  0  0  0
Si       17.99587500   7.19835000  -7.60000000  0  0  0
Si       10.79752500   0.00000000  -7.60000000  0  0  0
Si       17.99587500   0.00000000  -7.60000000  0  0  0
H        12.89752500   7.19835000  -9.40000000  0  0  0
H         8.69752500   7.19835000  -9.40000000  0  0  0
H        20.09587500   7.19835000  -9.40000000  0  0  0
H        15.89587500   7.19835000  -9.40000000  0  0  0
H        12.89752500   0.00000000  -9.40000000  0  0  0
H         8.69752500   0.00000000  -9.40000000  0  0  0
H        20.09587500   0.00000000  -9.40000000  0  0  0
H        15.89587500   0.00000000  -9.40000000  0  0  0
last_image
Si       8.472330841   3.600583711   2.168169163
Si      12.898398887   3.599061696   2.186786225
Si       8.586785223   0.086978384  -0.771506632
Si       8.587325096   7.111877751  -0.768441643
Si      12.983360476   7.115115556  -0.737726857
Si      12.981576168   0.084546884  -0.735118510
Si       7.302618068   3.600948032  -2.980309976
Si       7.098754396  -3.598207353  -2.357153735
Si      14.209730212   3.597886598  -2.970999964
Si      14.459594393  -3.599128700  -2.352619378
Si      10.760159199   3.599567862  -5.451711568
Si      10.783817535  -3.598768371  -4.975693256
Si      17.979750932  -3.599176567  -4.999362791
Si      17.954630751   3.599200343  -5.121900920
Si       10.79752500   7.19835000  -7.60000000
Si       17.99587500   7.19835000  -7.60000000
Si       10.79752500   0.00000000  -7.60000000
Si       17.99587500   0.00000000  -7.60000000
H        12.89752500   7.19835000  -9.40000000
H         8.69752500   7.19835000  -9.40000000
H        20.09587500   7.19835000  -9.40000000
H        15.89587500   7.19835000  -9.40000000
H        12.89752500   0.00000000  -9.40000000
H         8.69752500   0.00000000  -9.40000000
H        20.09587500   0.00000000  -9.40000000
H        15.89587500   0.00000000  -9.40000000
EOF
$ECHO "  running sixth SMD calculation ...\c"
if test "0$1" -ge 6 ; then
    $CP_COMMAND < smd6.in > smd6.out
    $ECHO " done"
else
    $ECHO " skipped" # too big, don't run
fi

cat > smd7.in << EOF
 &control
    restart_mode='restart',
    calculation='smd',
    nstep=300, iprint=100, dt=10.d0,
    ndr=70, ndw=70,
    pseudo_dir = '$PSEUDO_DIR/',
    outdir='$TMP_DIR/'
 /
 &system
    ibrav = 14,
    celldm(1) = 14.3967d0, celldm(2) = 1.d0, celldm(3) = 1.3d0,
    celldm(4) = 0.d0, celldm(5) = 0.d0, celldm(6) = 0.d0,
    nat   = 26, nbnd  = 40, nelec  = 80, ntyp  = 2, ecutwfc  = 12.0d0,
    nr1b  = 16, nr2b = 16, nr3b = 16,
    xc_type = 'PZ'
 /
 &electrons
    emass = 500.d0,
    emass_cutoff = 2.5d0,
    electron_damping = 0.1,
    orthogonalization = 'ortho',
    electron_dynamics = 'damp',
 /
 &ions
    ion_dynamics = 'damp',
    ion_damping = 0.01,
    num_of_images = 10,
    ion_radius(1) = 1.0,
    ion_radius(2) = 1.0,
    smd_smcp = .false.,
    smd_smlm = .true.,
    smd_smopt = .false.,
    smd_linr = .true.,
    smd_polm = .false.,
    smd_kwnp = 2,
    smd_stcd = .false.,
    smd_lmfreq  = 1,
    smd_tol = 1.d-5,
    smd_maxlm = 100,
    smd_codf = 50,
    smd_forf = 50,
    smd_smwf = 1,
    smd_ene_ini = -75.01969,
    smd_ene_fin = -75.03376 
 /
ATOMIC_SPECIES
Si  10.0  Si.vbc.UPF 4
H   10.0  H.vbc.UPF  4
K_POINTS ( gamma )
ATOMIC_POSITIONS ( bohr )
first_image
Si      10.775166917   1.063244573   3.343251712
Si      10.754798756   6.063372808   3.328320441
Si       8.376020820   0.022551091  -0.335304264
Si       8.251195082   7.044890119  -0.250169658
Si      13.284658653   7.174660007  -0.223938232
Si      13.203527321   0.153946724  -0.326655168
Si       7.181555534   3.526386193  -2.609991910
Si       7.310566102  -3.661066027  -2.446982016
Si      14.386467659   3.681546725  -2.591582642
Si      14.258348763  -3.537912425  -2.428409132
Si      10.787703249   3.602320221  -5.162014074
Si      10.789827407  -3.607727761  -5.163581985
Si      17.981530206  -3.597398649  -4.902229019
Si      17.979324999   3.597821759  -5.096370053
Si       10.79752500   7.19835000  -7.60000000  0  0  0
Si       17.99587500   7.19835000  -7.60000000  0  0  0
Si       10.79752500   0.00000000  -7.60000000  0  0  0
Si       17.99587500   0.00000000  -7.60000000  0  0  0
H        12.89752500   7.19835000  -9.40000000  0  0  0
H         8.69752500   7.19835000  -9.40000000  0  0  0
H        20.09587500   7.19835000  -9.40000000  0  0  0
H        15.89587500   7.19835000  -9.40000000  0  0  0
H        12.89752500   0.00000000  -9.40000000  0  0  0
H         8.69752500   0.00000000  -9.40000000  0  0  0
H        20.09587500   0.00000000  -9.40000000  0  0  0
H        15.89587500   0.00000000  -9.40000000  0  0  0
last_image
Si       8.472330841   3.600583711   2.168169163
Si      12.898398887   3.599061696   2.186786225
Si       8.586785223   0.086978384  -0.771506632
Si       8.587325096   7.111877751  -0.768441643
Si      12.983360476   7.115115556  -0.737726857
Si      12.981576168   0.084546884  -0.735118510
Si       7.302618068   3.600948032  -2.980309976
Si       7.098754396  -3.598207353  -2.357153735
Si      14.209730212   3.597886598  -2.970999964
Si      14.459594393  -3.599128700  -2.352619378
Si      10.760159199   3.599567862  -5.451711568
Si      10.783817535  -3.598768371  -4.975693256
Si      17.979750932  -3.599176567  -4.999362791
Si      17.954630751   3.599200343  -5.121900920
Si       10.79752500   7.19835000  -7.60000000
Si       17.99587500   7.19835000  -7.60000000
Si       10.79752500   0.00000000  -7.60000000
Si       17.99587500   0.00000000  -7.60000000
H        12.89752500   7.19835000  -9.40000000
H         8.69752500   7.19835000  -9.40000000
H        20.09587500   7.19835000  -9.40000000
H        15.89587500   7.19835000  -9.40000000
H        12.89752500   0.00000000  -9.40000000
H         8.69752500   0.00000000  -9.40000000
H        20.09587500   0.00000000  -9.40000000
H        15.89587500   0.00000000  -9.40000000
EOF
$ECHO "  running seventh SMD calculation ...\c"
if test "0$1" -ge 7 ; then
    $CP_COMMAND < smd7.in > smd7.out
    $ECHO " done"
else
    $ECHO " skipped" # too big, don't run
fi

# clean TMP_DIR
$ECHO "  cleaning $TMP_DIR...\c"
rm -rf $TMP_DIR/*
$ECHO " done"

$ECHO
$ECHO "$EXAMPLE_DIR : done"
