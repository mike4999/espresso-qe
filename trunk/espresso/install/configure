#!/bin/sh

lista=`ls install | sed -e '/Make\./!d' -e 's/^Make.//'`

if [ "$#" != 1 ]
then
	echo "The architecture name is not specified"
        echo "Valid architectures are : "
        for i in $lista
        do
          echo - $i
        done
	exit 1
fi

result=`echo $lista | grep "$1"`

if [ "$result" ]
then
	PWD=`pwd`
	echo OSHOME=$PWD > make.sys 
	if [ "$1" = "pc_ifc" -o  "$1" = "beo_ifc" ]
	then
                echo creating catalog file for Intel compiler
		echo work.pc > $PWD/Modules/intel.pcl

		echo work.pc > $PWD/upftools/intel.pcl

		echo work.pc > $PWD/flib/intel.pcl
		echo $PWD/Modules/work.pc >> $PWD/flib/intel.pcl

		echo work.pc > $PWD/PW/intel.pcl
		echo $PWD/Modules/work.pc >> $PWD/PW/intel.pcl

		echo work.pc > $PWD/PH/intel.pcl
		echo $PWD/Modules/work.pc >> $PWD/PH/intel.pcl
		echo $PWD/PW/work.pc >> $PWD/PH/intel.pcl

		echo work.pc > $PWD/PP/intel.pcl
		echo $PWD/Modules/work.pc >> $PWD/PP/intel.pcl
		echo $PWD/PW/work.pc >> $PWD/PP/intel.pcl

		echo work.pc > $PWD/Gamma/intel.pcl
		echo $PWD/Modules/work.pc >> $PWD/Gamma/intel.pcl
		echo $PWD/PW/work.pc >> $PWD/Gamma/intel.pcl

		echo work.pc > $PWD/D3/intel.pcl
		echo $PWD/Modules/work.pc >> $PWD/D3/intel.pcl
		echo $PWD/PW/work.pc >> $PWD/D3/intel.pcl
		echo $PWD/PH/work.pc >> $PWD/D3/intel.pcl

                echo work.pc > $PWD/PWCOND/intel.pcl
                echo $PWD/Modules/work.pc >> $PWD/PWCOND/intel.pcl
                echo $PWD/PW/work.pc >> $PWD/PWCOND/intel.pcl

		echo work.pc > $PWD/pwtools/intel.pcl
		echo $PWD/Modules/work.pc >> $PWD/pwtools/intel.pcl
		echo $PWD/PW/work.pc >> $PWD/pwtools/intel.pcl

		echo work.pc > $PWD/FPMD/intel.pcl
		echo $PWD/Modules/work.pc >> $PWD/FPMD/intel.pcl

                echo work.pc > $PWD/CPV/intel.pcl
                echo $PWD/Modules/work.pc >> $PWD/CPV/intel.pcl

                echo work.pc > $PWD/flib/intel.pcl
                echo $PWD/Modules/work.pc >> $PWD/flib/intel.pcl
	fi

	cat install/Make.$1 >> make.sys

        case "$1" in
          pc_ifc | beo_ifc | ibm    | ibmsp | origin | nec | t3e | \
          alpha  | alphaMPI| hitachi | irix | cygwin | hp )
    # f90 compilers that support C-style preprocessing 
            cp install/Rules.nocpp make.rules
          ;;
          pc_pgi | pc_abs | beowulf | fujitsu | sun   | sunmpi | sxcross | \
          pc_lahey )
    # f90 compilers that do not support C-style preprocessing
            cp install/Rules.cpp make.rules
          ;;
        esac

        cd install; make
        ./sizeof.x
        ./shdep
	exit 0
else
        echo "Valid architectures are : "
        for i in $lista
        do
          echo - $i
        done
	exit 1
fi
